<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>YouDigest News</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1>YouDigest News</h1>

<button id="generateBtn">Generate & Play</button>

<div class="progress-container">
  <div class="progress-bar" id="progressBar"></div>
</div>

<audio id="newsAudio" controls></audio>
<br>
Speed:
<select id="speedSelect">
  <option value="1">1x</option>
  <option value="1.5">1.5x</option>
  <option value="2">2x</option>
</select>

<script>
const audioEl = document.getElementById("newsAudio");
const speedEl = document.getElementById("speedSelect");
const progressBar = document.getElementById("progressBar");

speedEl.addEventListener("change", () => {
  audioEl.playbackRate = parseFloat(speedEl.value);
});

audioEl.addEventListener("timeupdate", () => {
  const progress = (audioEl.currentTime / audioEl.duration) * 100;
  progressBar.style.width = progress + "%";
});

document.getElementById("generateBtn").addEventListener("click", async () => {
  try {
    document.getElementById("generateBtn").innerText = "Generating...";

    // Replace these with your actual headlines or fetched data
    const sections = [
      { name: "Global", headlines: ["Global leaders meet to discuss climate change", "Tech summit opens in Europe"] },
      { name: "US", headlines: ["US stock market rises", "President announces new policy"] },
      { name: "Colorado", headlines: ["Denver hosts tech conference", "Local elections results announced"] }
    ];

    let fullScript = "";

    for (const sec of sections) {
      const res = await fetch("/api/summarize", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ section: sec.name, headlines: sec.headlines })
      });

      const data = await res.json();
      fullScript += `Section: ${sec.name}\n${data.summary}\n\n`;
    }

    const ttsRes = await fetch("/api/tts", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text: fullScript })
    });

    if (!ttsRes.ok) {
      const err = await ttsRes.json();
      alert("TTS Error: " + (err.details || err.error));
      document.getElementById("generateBtn").innerText = "Generate & Play";
      return;
    }

    const blob = await ttsRes.blob();
    audioEl.src = URL.createObjectURL(blob);
    audioEl.play();
    document.getElementById("generateBtn").innerText = "Generate & Play";

  } catch (err) {
    console.error(err);
    alert("Error generating news");
    document.getElementById("generateBtn").innerText = "Generate & Play";
  }
});
</script>
</body>
</html>
